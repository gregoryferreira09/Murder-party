<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Lancement de la Partie - Murder Party</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../Public/styles/style.css">
  <!-- ... styles ... -->
</head>
<body>
  <!-- ... header, main, etc. inchangés ... -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="../JS/personnages.js"></script>
  <script src="../JS/Scenario.js"></script>
  <script>
    function afficherScenario(scenarioObj, scenarioData) {
      document.getElementById("scenario-loading").style.display = "none";
      document.getElementById("scenario-content").style.display = "block";
      document.getElementById("introduction").innerHTML = scenarioObj.introduction || "";
      document.getElementById("crime").innerHTML = scenarioObj.crime || "";
      document.getElementById("objectif").innerHTML = scenarioObj.objectif || "";
      document.getElementById("mode").textContent = scenarioData.mode || "-";
      document.getElementById("duree").textContent = (scenarioData.duree ? scenarioData.duree + " min" : "-") + (scenarioObj.detailsDuree ? " — " + scenarioObj.detailsDuree : "");
      document.getElementById("periode").textContent = scenarioData.periode || "-";
      document.getElementById("joueurs").textContent = scenarioData.nombreJoueurs || "-";
      document.getElementById("criminels").textContent = scenarioData.criminels || "-";
      document.getElementById("fantome").textContent = scenarioData.criminelFantome ? "Oui" : "Non";
      document.getElementById("avatars").textContent = scenarioData.avatarsLegendaires ? "Oui" : "Non";
      document.getElementById("messageInfo").textContent = "";
    }
    function chargerScenario() {
      try {
        let scenarioData = JSON.parse(localStorage.getItem("parametresPartie"));
        if (!scenarioData) throw new Error("Aucune donnée de scénario.");
        if (typeof genererScenario === "function") {
          genererScenario();
          setTimeout(() => {
            let scenarioObj = JSON.parse(localStorage.getItem("scenarioCourant") || "null");
            if (scenarioObj) {
              afficherScenario(scenarioObj, scenarioData);
            }
          }, 200);
        }
      } catch (e) {
        document.getElementById("scenario-loading").style.display = "none";
        document.getElementById("scenario-content").style.display = "none";
        document.getElementById("messageInfo").textContent = "Erreur lors du chargement du scénario.";
      }
    }
    document.addEventListener("DOMContentLoaded", function() {
      chargerScenario();
      // Bouton régénération
      const regenBtn = document.getElementById("regenScenarioBtn");
      regenBtn.onclick = function() {
        if (typeof genererScenario === "function") {
          genererScenario();
          setTimeout(chargerScenario, 200);
        }
      };
      regenBtn.onkeydown = function(e) {
        if (e.key === "Enter" || e.key === " ") {
          regenBtn.click();
        }
      };
      // Timer bouton démarrer
      const launchBtn = document.getElementById("demarrerBtn");
      let timeLeft = 30;
      launchBtn.textContent = `Disponible dans ${timeLeft}s`;
      launchBtn.style.pointerEvents = "none";
      launchBtn.style.opacity = "0.6";
      const interval = setInterval(() => {
        timeLeft--;
        if (timeLeft > 0) {
          launchBtn.textContent = `Disponible dans ${timeLeft}s`;
        } else {
          clearInterval(interval);
          launchBtn.textContent = "Démarrer la partie";
          launchBtn.style.pointerEvents = "auto";
          launchBtn.style.opacity = "1";
        }
      }, 1000);
      setTimeout(() => {
        document.querySelector(".page-lancement").focus();
      }, 600);
      window.addEventListener('offline', () => {
        document.getElementById("messageInfo").textContent = "Vous êtes hors ligne.";
      });
      window.addEventListener('online', () => {
        window.location.reload();
      });
    });
  </script>
  <!-- ... noscript ... -->
</body>
</html>
