<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>générerscenario.html</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #222;
      font-family: 'Georgia', serif;
      color: #f3e9d2;
      margin: 0; padding: 0;
      min-height: 100vh;
      box-sizing: border-box;
    }
    .container {
      max-width: 750px;
      margin: 50px auto;
      background: #2e211a;
      border-radius: 16px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.7);
      padding: 36px 32px 32px 32px;
      border: 2px solid #c49b66;
      position: relative;
    }
    h1 {
      color: #ffe6b3;
      font-size: 2.1em;
      text-align: center;
      margin-top: 0;
      letter-spacing: 1px;
      text-shadow: 2px 2px 8px #000;
    }
    .molette-btn {
      background: #c49b66;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 62px;
      height: 62px;
      font-size: 2.3em;
      cursor: pointer;
      position: absolute;
      top: -31px;
      right: 28px;
      box-shadow: 0 2px 8px #0007;
      transition: transform 0.2s;
    }
    .molette-btn:active {
      transform: rotate(90deg) scale(1.1);
    }
    .selectors {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      gap: 34px;
      margin: 0 0 28px 0;
      flex-wrap: wrap;
    }
    .slider-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 170px;
    }
    .slider-label {
      font-size: 1.1em;
      color: #ffe6b3;
      margin-bottom: 7px;
      letter-spacing: 0.5px;
    }
    .slider-epoque {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 12px;
      margin-top: 4px;
    }
    .epoque-btn {
      background: #c49b66;
      color: #21190f;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      font-size: 1.3em;
      cursor: pointer;
      transition: background 0.15s;
    }
    .epoque-btn:active {
      background: #a27b4b;
    }
    .epoque-list {
      display: flex;
      overflow-x: auto;
      gap: 12px;
      padding: 2px 0;
      max-width: 210px;
      scrollbar-width: thin;
      scrollbar-color: #c49b66 #2e211a;
    }
    .epoque-item {
      min-width: 92px;
      padding: 7px 16px;
      border-radius: 8px;
      background: #3e2e21;
      color: #ffe6b3;
      text-align: center;
      font-size: 1em;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border 0.15s, background 0.15s;
      user-select: none;
    }
    .epoque-item.selected {
      border: 2px solid #c49b66;
      background: #5a3e2b;
      color: #fff3d6;
      font-weight: bold;
    }
    /* Nombre de joueurs slider */
    .slider-nbjoueurs input[type="range"] {
      width: 140px;
      accent-color: #c49b66;
    }
    .slider-nbjoueurs .slider-value {
      margin-top: 4px;
      font-size: 1.2em;
      color: #ffe6b3;
      font-weight: bold;
      text-shadow: 1px 1px 1px #0009;
      letter-spacing: 1px;
    }
    /* Scénario sections */
    .scenario-section {
      background: rgba(44,30,22,0.90);
      border-left: 4px solid #c49b66;
      margin-bottom: 18px;
      padding: 18px 18px 10px 18px;
      border-radius: 7px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.13);
      min-height: 54px;
    }
    h2 {
      color: #ffe6b3;
      margin-top: 0;
      font-size: 1.2em;
      margin-bottom: 7px;
      text-align: left;
    }
    .scenario-section p {
      margin: 0;
      font-size: 1.08em;
      line-height: 1.6;
    }
    @media (max-width: 600px) {
      .container { padding: 10px 2px; }
      .selectors { flex-direction: column; gap: 16px; }
      .slider-group { min-width: unset; }
      .molette-btn { right: 8px; }
      .epoque-list { max-width: 120px; }
      .epoque-item { min-width: 68px; font-size: 0.98em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Générateur de Scénario</h1>
    <button class="molette-btn" id="regenBtn" title="Générer un autre scénario">&#x1F5D3;</button>
    <div class="selectors">
      <!-- Bandeau défilant époque -->
      <div class="slider-group">
        <div class="slider-label">Époque</div>
        <div class="slider-epoque">
          <button class="epoque-btn" id="epoqueLeftBtn">&#x25C0;</button>
          <div class="epoque-list" id="epoqueList"></div>
          <button class="epoque-btn" id="epoqueRightBtn">&#x25B6;</button>
        </div>
      </div>
      <!-- Slider nombre de joueurs -->
      <div class="slider-group slider-nbjoueurs">
        <div class="slider-label">Nombre de joueurs</div>
        <input type="range" min="3" max="12" value="7" id="nbJoueursSlider">
        <div class="slider-value"><span id="nbJoueursValue">7</span></div>
      </div>
    </div>
    <div class="scenario-section">
      <h2>Introduction</h2>
      <p id="introduction"></p>
    </div>
    <div class="scenario-section">
      <h2>Le crime</h2>
      <p id="crime"></p>
    </div>
    <div class="scenario-section">
      <h2>Suspects</h2>
      <p id="suspects"></p>
    </div>
    <div class="scenario-section">
      <h2>Indice & Témoin</h2>
      <p id="indice"></p>
    </div>
    <div class="scenario-section">
      <h2>Objectif général</h2>
      <p id="objectif"></p>
    </div>
  </div>
  <script>
    // --- Données simplifiées inspirées de univers.js (adapte avec import réel) ---
    const univers = {
      medieval: {
        lieux: [{nom:"château", genre:"m"},{nom:"grande salle", genre:"f"},{nom:"forêt", genre:"f"}],
        personnages: [
          {nom:"le seigneur de Montfaucon", genre:"m"}, {nom:"la servante Ysabeau", genre:"f"}, {nom:"le chevalier Gaspard", genre:"m"},
          {nom:"la dame Aliénor", genre:"f"}, {nom:"le bouffon Arthus", genre:"m"}, {nom:"la cuisinière Berthe", genre:"f"}
        ],
        armes: ["une épée", "une dague rouillée", "du poison"],
        indices: ["des traces de sang mènent vers la cave", "un médaillon brisé a été retrouvé sous une table"],
        mobiles: ["la vengeance", "un héritage contesté"],
        intro: [
          "Le banquet bat son plein dans {la_lieu}. Les seigneurs et les dames murmurent à voix basse.",
          "La tension monte dans {la_lieu}, alors que {suspect1} semble s’éclipser discrètement.",
          "Des rumeurs courent sur {motif}. Les regards se croisent dans {la_lieu}."
        ],
        ambiances: ["Le banquet bat son plein", "Une tempête gronde au-dehors"]
      },
      victorien: {
        lieux: [
          {nom:"manoir",genre:"m"},{nom:"bibliothèque",genre:"f"},{nom:"salon",genre:"m"},
          {nom:"jardin",genre:"m"},{nom:"salle de bal",genre:"f"},{nom:"serre",genre:"f"}
        ],
        personnages: [
          {nom:"le comte Ashford",genre:"m"},{nom:"la gouvernante Wells",genre:"f"},{nom:"le colonel Rutherford",genre:"m"},
          {nom:"lady Emily",genre:"f"},{nom:"le majordome Carter",genre:"m"},{nom:"le jardinier Hopkins",genre:"m"},
          {nom:"la cuisinière Mrs. Doyle",genre:"f"}
        ],
        armes: ["un chandelier","une dague","du poison","un revolver"],
        indices: ["un mouchoir monogrammé oublié sur le sol","un carnet griffonné tombé sous un canapé"],
        mobiles: ["la jalousie","un secret inavoué","l’héritage"],
        intro: [
          "{ambiance} dans {la_lieu}. Les secrets se murmurent, les regards s’évitent.",
          "Le manoir vibre d’une excitation étrange. {suspect1} semble préoccupé·e ce soir.",
          "Dans {la_lieu}, la tension monte. Des rumeurs courent sur {motif}.",
          "Un bal masqué s’organise : la jalousie couve entre {suspect1} et {suspect2}."
        ],
        ambiances: [
          "Le tonnerre gronde au loin",
          "Les invités masqués se perdent dans la fête",
          "Le brouillard étreint le jardin"
        ]
      }
      // Ajoute les autres époques si besoin...
    };
    const epoques = [
// Génère dynamiquement la liste des époques à partir des clés de l'objet univers
const epoques = Object.keys(univers).map(key => ({
  key,
  label: key.charAt(0).toUpperCase() + key.slice(1) // ou une fonction pour mieux formater
}));

    // --- Générateur dynamique ---
    function getArticle(word, articles = { m: 'le', f: 'la' }) {
      if (!word) return '';
      word = word.trim();
      const firstLetter = word[0].toLowerCase();
      if ("aeiouyh".includes(firstLetter)) return "l'";
      const feminine = ["bibliothèque", "gouvernante", "salle", "cave", "chapelle", "forêt", "dimension", "galerie", "voix", "technicienne", "serre"];
      if (feminine.some(x => word.toLowerCase().startsWith(x))) return articles.f;
      return articles.m;
    }
    function articleDans(word, article) {
      if (article === "le") return "dans le";
      if (article === "la") return "dans la";
      if (article === "l'") return "dans l'";
      return "dans";
    }
    function randomItem(array) {
      return array[Math.floor(Math.random() * array.length)];
    }
    function genererScenario(periode, options) {
      const data = univers[periode];
      if (!data) throw new Error("Période inconnue");

      // Lieu & ambiance
      const lieuObj = randomItem(data.lieux);
      const lieu = lieuObj.nom;
      const artLieu = getArticle(lieu, { m: 'le', f: 'la' });
      const artDansLieu = articleDans(lieu, artLieu);

      // Ambiance et intro
      const ambiance = randomItem(data.ambiances);
      const introTpl = randomItem(data.intro);
      
      // Personnages (suspects)
      let persos = [...data.personnages];
      const victimeObj = randomItem(persos);
      const victime = victimeObj.nom;
      persos = persos.filter(p=>p.nom !== victime);
      // Nombre de suspects selon joueurs (au moins 3)
      const nbSuspects = Math.max(3, Math.min(options.nbJoueurs-2, persos.length));
      const suspects = [];
      while(suspects.length < nbSuspects) {
        const s = randomItem(persos);
        if (!suspects.find(x=>x.nom===s.nom)) suspects.push(s);
      }
      // Témoin différent
      let temoin = randomItem(persos.filter(p=>!suspects.find(x=>x.nom===p.nom)));
      if (!temoin) temoin = randomItem(persos);

      // Arme, indice, mobile
      const arme = randomItem(data.armes);
      const indice = randomItem(data.indices);
      const mobile = randomItem(data.mobiles);

      // Variables pour template
      const variables = {
        "{la_lieu}": artLieu + (artLieu.endsWith("'") ? "" : " ") + lieu,
        "{ambiance}": ambiance,
        "{suspect1}": suspects[0]?.nom || "",
        "{suspect2}": suspects[1]?.nom || "",
        "{motif}": mobile
      };
      let introduction = introTpl;
      Object.entries(variables).forEach(([k,v])=>{introduction = introduction.replaceAll(k,v);});

      // Crime
      const crime = `Un cri retentit : <b>${victime}</b> est retrouvé·e sans vie <b>${artDansLieu} ${lieu}</b>, ${arme} à ses côtés.<br>
      <i>Indice trouvé :</i> ${indice}.<br>
      <i>Mobile soupçonné :</i> ${mobile}.`;

      // Suspects
      const suspectsText = suspects.map(s=>s.nom).join(" <b>&bull;</b> ");

      // Indice & témoin
      const indiceText = `<b>Témoin clef :</b> ${temoin.nom}<br><b>Indice :</b> ${indice}`;

      // Objectif
      const objectif = "Découvrez qui est le meurtrier avant la fin de la partie.";

      return { introduction, crime, suspects: suspectsText, indice: indiceText, objectif };
    }

    // --- UI dynamique ---
    let selectedEpoqueIdx = 1; // victorien par défaut
    function renderEpoqueList() {
      const list = document.getElementById('epoqueList');
      list.innerHTML = '';
      epoques.forEach((ep, idx) => {
        const div = document.createElement('div');
        div.className = 'epoque-item' + (idx === selectedEpoqueIdx ? ' selected' : '');
        div.textContent = ep.label;
        div.onclick = () => { selectedEpoqueIdx = idx; renderEpoqueList(); updateScenario(); };
        list.appendChild(div);
      });
      // Scroll to selected
      const selected = list.children[selectedEpoqueIdx];
      if (selected) selected.scrollIntoView({inline: "center", behavior: "smooth"});
    }
    document.getElementById('epoqueLeftBtn').onclick = () => {
      selectedEpoqueIdx = (selectedEpoqueIdx - 1 + epoques.length) % epoques.length;
      renderEpoqueList(); updateScenario();
    };
    document.getElementById('epoqueRightBtn').onclick = () => {
      selectedEpoqueIdx = (selectedEpoqueIdx + 1) % epoques.length;
      renderEpoqueList(); updateScenario();
    };

    // Slider nombre de joueurs
    const nbJoueursSlider = document.getElementById('nbJoueursSlider');
    const nbJoueursValue = document.getElementById('nbJoueursValue');
    nbJoueursSlider.oninput = () => {
      nbJoueursValue.textContent = nbJoueursSlider.value;
      updateScenario();
    };

    // Molette bouton
    document.getElementById('regenBtn').onclick = () => {
      updateScenario(true);
    };

    // Génération de scénario affichage
    function updateScenario(forceNew) {
      const periode = epoques[selectedEpoqueIdx].key;
      const nbJoueurs = Number(nbJoueursSlider.value);
      const scenario = genererScenario(periode, {nbJoueurs});
      document.getElementById('introduction').innerHTML = scenario.introduction;
      document.getElementById('crime').innerHTML = scenario.crime;
      document.getElementById('suspects').innerHTML = scenario.suspects;
      document.getElementById('indice').innerHTML = scenario.indice;
      document.getElementById('objectif').innerHTML = scenario.objectif;
    }

    // Initialisation
    renderEpoqueList();
    updateScenario();
  </script>
</body>
</html>
