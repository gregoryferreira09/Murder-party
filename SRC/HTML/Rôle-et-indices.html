<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>R√¥le et Indices - Murder Party</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../Public/styles/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative&family=Cormorant+Garamond&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <h1>üïµÔ∏è Enqu√™te</h1>
  </header>

  <main>
    <div class="bandeau-dore" style="margin-top:30px;">
      <div id="chrono">Temps restant : <span id="tempsRestant">30:00</span> | Connexions restantes : <span id="connexionRestantes">5</span></div>
      
      <div class="tabs" style="margin-bottom:20px; display:flex; justify-content:center;">
        <button class="gold-btn tab-button active" onclick="switchTab('fiche')">üé≠ Personnage</button>
        <button class="gold-btn tab-button" onclick="switchTab('indices')">üß© Indices</button>
        <button class="gold-btn tab-button" onclick="switchTab('vote')">‚öñÔ∏è Vote</button>
        <button class="gold-btn tab-button" onclick="switchTab('connexion')">ü§ù Connexion</button>
      </div>

      <!-- Onglet Personnage -->
      <section id="fiche" class="tab-content active">
        <h2>Nom : <span id="nomPersonnage">Inspecteur Alaric</span></h2>
        <img src="image-personnage.jpg" alt="Image du Personnage" style="width:80px; border-radius:50%; border:3px solid #e9c78c;">
        <p><strong>Histoire :</strong> Ancien d√©tective de Scotland Yard, rong√© par un pass√© trouble...</p>
        <p><strong>Pouvoir :</strong> Interrogez deux joueurs √† chaque tour...</p>
      </section>

      <!-- Onglet Indices -->
      <section id="indices" class="tab-content" style="display:none;">
        <h3>Vos indices :</h3>
        <div id="listeIndices"></div>
      </section>

      <!-- Bloc unique pour vote/connexion -->
      <section id="action" class="tab-content" style="display:none;">
        <h3 id="action-titre"></h3>
        <div class="connexion-joueur" id="action-joueurs"></div>
        <button class="gold-btn" id="action-btn"></button>
        <div id="actionResult" style="margin-top:10px;"></div>
      </section>
    </div>
  </main>

  <footer class="footer">
    <button class="btn-retour" onclick="window.location.href='accueil.html'">üè† Accueil</button><br>
    <p>¬© 2025 Murder Party. Tous droits r√©serv√©s. <a href="mentions-legales.html">Mentions l√©gales</a></p>
  </footer>

  <div class="effet-elimination" id="effetElimination"></div>

  <!-- Modale de connexion -->
  <div id="modal-connexion" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:2000;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;">
    <div style="background:#1a1a1a;border:2px solid #e0c185;border-radius:18px;padding:32px 24px;max-width:350px;text-align:center;color:#f4e4c1;">
      <h2>Connexion</h2>
      <p id="modal-connexion-text" style="margin-bottom:24px;"></p>
      <div style="display:flex;gap:18px;justify-content:center;">
        <button class="gold-btn" onclick="accepterConnexion()">Accepter</button>
        <button class="gold-btn" onclick="refuserConnexion()">Refuser</button>
      </div>
    </div>
  </div>

  <script>
    // Gestion des onglets
    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(c => {
        c.style.display = 'none';
        c.classList.remove('active');
      });
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));

      if(tabName === 'vote' || tabName === 'connexion') {
        document.getElementById('action').style.display = 'block';
        document.getElementById('action').classList.add('active');
        setupActionTab(tabName);
      } else {
        document.getElementById(tabName).style.display = 'block';
        document.getElementById(tabName).classList.add('active');
      }
      document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
    }
    document.addEventListener('DOMContentLoaded', function() {
      switchTab('fiche');
    });

    // Donn√©es de joueurs (inclut ton propre personnage pour le test)
    const joueurs = [
      { nom: 'Inspecteur Alaric', image: 'image-personnage.jpg', indices: [
        "Tu es pr√™t √† r√©soudre le myst√®re.",
        "Ta r√©putation te pr√©c√®de dans le domaine des enqu√™tes."
      ], fiabilite: "fiable" }, // Ton personnage
      { nom: 'Violette', image: 'violette.jpg', indices: [
        "A √©t√© vue avec la victime peu avant le crime.",
        "Semblait nerveuse lors du d√Æner."
      ], fiabilite: "fiable" },
      { nom: 'Brume', image: 'brume.jpg', indices: [
        "Poss√®de une cl√© suspecte.",
        "A disparu 10 minutes pendant la soir√©e."
      ], fiabilite: "suspect" }
    ];
    let connexionsRestantes = 5;
    let joueurSelectionne = null;

    // Pour le vote/connexion
    let actionType = null; // "vote" ou "connexion"
    let joueurSelectionAction = null;

    function setupActionTab(type) {
      actionType = type;
      joueurSelectionAction = null;
      document.getElementById('actionResult').innerHTML = "";

      // Titre et bouton
      if (type === "vote") {
        document.getElementById('action-titre').textContent = "Votez pour un suspect :";
        document.getElementById('action-btn').textContent = "Valider le vote";
      } else {
        document.getElementById('action-titre').textContent = "Connexion entre joueurs :";
        document.getElementById('action-btn').textContent = "Valider la connexion";
      }

      // Liste des joueurs
      const joueursDiv = document.getElementById('action-joueurs');
      joueursDiv.innerHTML = '';
      joueurs.forEach(j => {
        const div = document.createElement('div');
        div.innerHTML = `<img src="${j.image}" alt="${j.nom}" style="width:80px; border-radius:50%; border:3px solid #e9c78c;"><br>${j.nom}`;
        div.style.cursor = "pointer";
        div.onclick = function() {
          joueurSelectionAction = j;
          joueursDiv.querySelectorAll('div').forEach(d => d.style.boxShadow = "");
          div.style.boxShadow = "0 0 8px 3px #e9c78c";
        };
        joueursDiv.appendChild(div);
      });

      // On change dynamiquement la fonction du bouton selon l'onglet
      document.getElementById('action-btn').onclick = function() {
        if (!joueurSelectionAction) return alert("Merci de s√©lectionner un joueur !");
        if (actionType === "vote") {
          document.getElementById('actionResult').innerHTML = `<p>üïØÔ∏è Votre vote pour <strong>${joueurSelectionAction.nom}</strong> a √©t√© scell√©...</p>`;
          const effet = document.getElementById("effetElimination");
          effet.classList.add("visible");
          setTimeout(() => effet.classList.remove("visible"), 2000);
        } else {
          validerConnexion();
        }
      }
    }

    // Logique de connexion et affichage de la modale
    function validerConnexion() {
      if (!joueurSelectionAction || connexionsRestantes <= 0) return alert("Connexion impossible.");
      showConnexionModal(joueurSelectionAction.nom);
    }

    function showConnexionModal(nomCible) {
      document.getElementById('modal-connexion-text').textContent =
        `Voulez-vous vous connecter avec ${nomCible} ?`;
      document.getElementById('modal-connexion').style.display = 'flex';
    }

    function accepterConnexion() {
      document.getElementById('modal-connexion').style.display = 'none';
      // Ajoute ici la logique de connexion effective si besoin
      alert("Connexion accept√©e ! üéâ");
      // D√©cr√©mente les connexions restantes si besoin
      connexionsRestantes--;
      document.getElementById("connexionRestantes").textContent = connexionsRestantes;

      // Exemple : affichage indice
      const indice = joueurSelectionAction.indices[Math.floor(Math.random() * joueurSelectionAction.indices.length)];
      const estFiable = joueurSelectionAction.fiabilite === "fiable";
      const fiabiliteTexte = estFiable ? "Haute" : "Douteuse";
      const fiabiliteClasse = estFiable ? "fiable" : "suspect";

      const indiceDiv = document.createElement('div');
      indiceDiv.className = 'indice';
      indiceDiv.innerHTML = `<p>üîç "${indice}"</p><p><span class="fiabilite ${fiabiliteClasse}">Fiabilit√© : ${fiabiliteTexte}</span></p>`;
      document.getElementById('listeIndices').appendChild(indiceDiv);

      // Bonus sp√©cial al√©atoire
      if (Math.random() < 0.25) {
        alert("Vous ressentez une connexion √©trange... un souvenir refait surface !");
        const bonus = document.createElement('div');
        bonus.className = 'indice';
        bonus.innerHTML = `<p>üéÅ Un indice bonus vous traverse l'esprit : "Un alli√© secret pourrait √™tre proche..."</p>`;
        document.getElementById('listeIndices').appendChild(bonus);
      }
    }

    function refuserConnexion() {
      document.getElementById('modal-connexion').style.display = 'none';
      alert("Connexion refus√©e.");
    }

    // Chronom√®tre
    let secondes = 1800;
    function updateChrono() {
      const minutes = Math.floor(secondes / 60);
      const sec = secondes % 60;
      document.getElementById("tempsRestant").textContent = `${minutes}:${sec < 10 ? '0' : ''}${sec}`;
      if (secondes > 0) secondes--;
    }
    setInterval(updateChrono, 1000);

    // Initialisation au chargement
    document.addEventListener('DOMContentLoaded', function() {
      switchTab('fiche');
    });
  </script>
</body>
</html>
