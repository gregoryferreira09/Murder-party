<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Accueil - Murder Party</title>
  
  <!-- ✅ Optimisation mobile + encoche -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

  <meta name="description" content="Bienvenue dans Murder Party, un jeu de mystère et d’enquête à vivre entre amis. Créez, rejoignez, et résolvez le crime.">
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/848/848043.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">

  <!-- ✅ Préchargement image de fond -->
  <link rel="preload" href="https://cdn.pixabay.com/photo/2017/01/19/19/12/chandelier-1992930_960_720.jpg" as="image">

  <!-- Lien vers ton fichier CSS externe -->
  <link rel="stylesheet" href="../../Public/styles/style.css">

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('Service Worker enregistré:', reg.scope))
          .catch(err => console.error('Erreur Service Worker:', err));
      });
    }
  </script>

  <!-- Inclusion utils.js et application des paramètres -->
  <script type="module">
    import { applyUserSettings } from "../../Public/scripts/utils.js";
    applyUserSettings();
  </script>
</head>

<body>

  <header>
    <h1>Murder Party</h1>
  </header>

  <main>
    <div class="bandeau-dore">
      <!-- Message de bienvenue -->
      <p id="bienvenuePseudo"></p>
      <div class="scenario">
        <section class="menu-buttons">
          <button onclick="window.location.href='creer-partie.html'" aria-label="Créer une partie">🎮 Créer une partie</button>
          <button onclick="window.location.href='rejoindre-partie.html'" aria-label="Rejoindre une partie">👥 Rejoindre une partie</button>
          <button onclick="window.location.href='profil-joueur.html'" aria-label="Voir le profil">👤 Profil</button>
          <button onclick="window.location.href='boutique.html'" aria-label="Accéder à la boutique">🛍️ Boutique</button>
          <button onclick="window.location.href='parametres.html'" aria-label="Paramètres du jeu">⚙️ Paramètres</button>
        </section>
      </div>
    </div>
  </main>

  <footer class="footer">
    <p>© 2025 Murder Party. Tous droits réservés.</p>
    <a href="mentions-legales.html">Mentions légales</a>
  </footer>

  <!-- ✅ Affichage du pseudo de bienvenue -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const pseudo = localStorage.getItem("pseudo") || "Anonyme";
      document.getElementById("bienvenuePseudo").textContent = `Bienvenue, ${pseudo} !`;
    });
  </script>


  <!-- ✅ Ajout vibration au clic -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const buttons = document.querySelectorAll('button');
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          if (navigator.vibrate) navigator.vibrate(15);
        });
      });
    });
    
    // --- Configuration et initialisation Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyD-BxBu-4ElCqbHrZPM-4-6yf1-yWnL1bI",
  authDomain: "murder-party-ba8d1.firebaseapp.com",
  databaseURL: "https://murder-party-ba8d1-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "murder-party-ba8d1",
  storageBucket: "murder-party-ba8d1.firebasestorage.app",
  messagingSenderId: "20295055805",
  appId: "1:20295055805:web:0963719c3f23ab7752fad4",
  measurementId: "G-KSBMBB7KMJ"
};
if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();

const salonCode = localStorage.getItem("salonCode");
document.getElementById("codeSalon").textContent = salonCode;

const joueursDiv = document.getElementById("listeJoueurs");
const etatSalon = document.getElementById("etatSalon");
let totalJoueurs = 1;

// Récupère le nombre de joueurs attendus
db.ref('parties/' + salonCode + '/parametres').once('value', snap => {
  if (snap.exists()) {
    const parametres = snap.val();
    totalJoueurs = parseInt(parametres.nombreJoueurs) || 1;
  }
});

// Affiche les joueurs en temps réel
db.ref('parties/' + salonCode + '/joueurs').on('value', snapshot => {
  joueursDiv.innerHTML = "";
  let nbJoueurs = 0;
  snapshot.forEach(joueurSnap => {
    const pseudo = joueurSnap.val().pseudo;
    const li = document.createElement("li");
    li.textContent = pseudo;
    joueursDiv.appendChild(li);
    nbJoueurs++;
  });
  etatSalon.textContent = `${nbJoueurs} / ${totalJoueurs} joueurs connectés`;

  if (nbJoueurs >= totalJoueurs) {
    etatSalon.textContent = "Tous les joueurs sont connectés ! La partie va commencer.";
    setTimeout(() => {
      window.location.href = "lancement-partie.html";
    }, 2000);
  }
});
  </script>

</body>
</html>
