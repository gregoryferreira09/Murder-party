<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Profil Joueur - Murder Party</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../Public/styles/style.css">
</head>
<body>
<header>
  <h1 class="site-title">Murder Party</h1>
</header>

<main class="main-accueil" role="main">
  <h2 style="text-align:center; margin-bottom: 1.3em;">Profil Joueur</h2>
  <form id="profilForm" class="form-container" autocomplete="off" spellcheck="false">
    <label for="pseudo">Pseudo :</label>
    <input type="text" id="pseudo" name="pseudo" maxlength="20" required placeholder="Votre pseudo">

    <label for="avatar">Avatar :</label>
    <select id="avatar" name="avatar" required>
      <option value="">Choisissez un avatar</option>
      <option value="sherlock">Sherlock</option>
      <option value="missmarple">Miss Marple</option>
      <option value="hercule">Hercule Poirot</option>
      <option value="columbo">Columbo</option>
      <option value="inspecteur">Inspecteur Gadget</option>
      <option value="autre">Autre</option>
    </select>
    <div id="autreAvatarDiv" style="display:none;">
      <label for="autreAvatar">Précisez le nom de l'avatar :</label>
      <input type="text" id="autreAvatar" name="autreAvatar" maxlength="20" placeholder="Nom de l'avatar">
    </div>

    <label>
      <input type="checkbox" id="modeSombre" name="modeSombre">
      Activer le mode sombre
    </label>

    <div class="boutons-actions">
      <button class="main-btn" type="submit">Enregistrer</button>
      <a class="main-btn" href="./accueil.html">Retour</a>
    </div>
    <div class="message" id="message" role="alert" aria-live="polite"></div>
  </form>

  <section style="margin-top:32px;">
    <h3>Historique des parties</h3>
    <ul id="historiqueParties">
      <!-- Les parties jouées s'afficheront ici via JS -->
    </ul>
  </section>
</main>

<footer class="footer">
  <p>© 2025 Murder Party. Tous droits réservés.</p>
  <a href="mentions-legales.html">Mentions légales</a>
</footer>

<script src="../JS/profil-joueur.js"></script>
<script>
  // Affichage champ "autre avatar"
  const avatarSelect = document.getElementById('avatar');
  const autreAvatarDiv = document.getElementById('autreAvatarDiv');
  avatarSelect.addEventListener('change', function() {
    if (this.value === "autre") {
      autreAvatarDiv.style.display = "block";
      document.getElementById('autreAvatar').focus();
    } else {
      autreAvatarDiv.style.display = "none";
      document.getElementById('autreAvatar').value = "";
    }
  });

  // Gestion du submit sécurisé
  const profilForm = document.getElementById('profilForm');
  const message = document.getElementById('message');
  profilForm.addEventListener('submit', function(e) {
    e.preventDefault();
    message.textContent = "";
    if (avatarSelect.value === "autre") {
      const autre = document.getElementById('autreAvatar').value.trim();
      if (autre.length < 3) {
        message.textContent = "Merci de préciser le nom de l'avatar.";
        document.getElementById('autreAvatar').focus();
        return;
      }
    }
    // Logique JS d'enregistrement (gérée dans profil-joueur.js)
    if (typeof enregistrerProfil === "function") {
      enregistrerProfil(new FormData(profilForm))
        .then(() => {
          message.textContent = "Profil enregistré avec succès !";
          message.className = "message succes";
        })
        .catch(err => {
          message.textContent = err && err.message ? err.message : "Erreur lors de l'enregistrement.";
          message.className = "message";
        });
    } else {
      message.textContent = "Fonction d'enregistrement absente.";
    }
  });
</script>
<noscript>
  <div style="color: #e0c185; text-align: center; margin-top: 20px;" role="alert">
    ⚠️ JavaScript est désactivé. Vous ne pourrez pas gérer votre profil.
  </div>
</noscript>
</body>
</html>
