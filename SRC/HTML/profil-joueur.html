<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Profil - Murder Party</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../../Public/styles/style.css" />
  <style>
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 0.8s ease-in forwards;
    }
    @keyframes fadeIn {
      to { opacity: 1; transform: none; }
    }
    .badges-section { margin-top: 2rem; }
    .badges-section ul {
      display: flex; gap: 1rem; flex-wrap: wrap; list-style: none; padding: 0;
      justify-content: center;
    }
    .badges-section li img { width: 60px; height: 60px; object-fit: contain; }
    .visually-hidden {
      position: absolute;
      clip: rect(0 0 0 0);
      clip-path: inset(100%);
      height: 1px; width: 1px;
      overflow: hidden; white-space: nowrap; border: 0;
    }
    .feedback-message.error,
    .feedback-message.erreur {
      color: #c00; font-weight: bold; margin-top: 0.5rem;
    }
    .feedback-message.succes {
      color: green; font-weight: bold; margin-top: 0.5rem;
    }
    .historique-section { margin-top: 2rem; }
    .historique-section ul { padding-left: 1rem; }
    .profil-container {
      background: linear-gradient(145deg, #2c1b1b, #1f1313);
      border: 2px solid #e0c185;
      border-radius: 16px;
      padding: 30px 40px;
      margin: 40px auto;
      width: 90%;
      max-width: 800px;
      box-shadow: 0 0 20px rgba(224, 193, 133, 0.15);
      animation: fadeUp 0.8s ease-out;
      text-align: center;
      color: #f4e4c1;
      font-family: 'Cormorant Garamond', serif;
    }
    main { display: flex; flex-direction: column; align-items: center; }
    .profil-container { width: 100%; max-width: 650px; }
    .modal-buttons {
      display: flex;
      gap: 1.2em;
      justify-content: center;
      margin-top: 1em;
    }
    #avatar:active {
      filter: brightness(1.15) drop-shadow(0 0 5px #e0c185);
    }
    /* Style calligraphique dor√© */
    .pseudo-cally {
      font-family: 'Cinzel Decorative', cursive;
      color: #e0c185;
      font-size: 2em;
      outline: none;
      border: none;
      background: none;
      min-width: 40px;
      transition: box-shadow 0.2s;
      display: inline-block;
    }
    .pseudo-cally:focus {
      box-shadow: 0 0 8px #e0c18588;
    }
    .pseudo-crayon {
      cursor: pointer;
      font-size: 1.2em;
      vertical-align: middle;
      user-select: none;
      color: #e0c185;
      margin-left: 6px;
      transition: filter 0.2s;
    }
    .pseudo-crayon:hover, .pseudo-crayon:focus {
      filter: drop-shadow(0 0 4px #e0c185) brightness(1.2);
    }
    .avatar-section {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 24px;
    }
    .avatar-crayon {
      cursor: pointer;
      font-size: 1.6em;
      vertical-align: middle;
      user-select: none;
      color: #e0c185;
      transition: filter 0.2s;
    }
    .avatar-crayon:hover, .avatar-crayon:focus {
      filter: drop-shadow(0 0 4px #e0c185) brightness(1.2);
    }
  </style>
</head>

<body>
  <header role="banner">
    <h1>Murder Party</h1>
  </header>

  <main>
    <div class="bandeau-dore profil-container">
      <h1>Mon profil</h1>

      <!-- Section Avatar -->
      <section class="avatar-section" aria-labelledby="avatar-heading">
        <img id="avatar" src="/Public/images/avatar-1.png" alt="Avatar actuel" tabindex="0" role="button"
          aria-pressed="false" aria-haspopup="dialog" aria-controls="modal" onclick="ouvrirModal()"
          onerror="this.onerror=null; this.src='/Public/images/default-avatar.png'; this.alt='Avatar par d√©faut';"
          style="cursor:pointer; width:96px; height:96px; border-radius:50%; border:2px solid #e0c185;" />
        <span onclick="ouvrirModal()" title="Changer l'avatar"
              class="avatar-crayon" tabindex="0" role="button" aria-label="Changer l'avatar">üñãÔ∏è</span>
      </section>

      <!-- Section Pseudo -->
      <section class="pseudo-section" aria-labelledby="pseudo-heading" style="text-align: center;">
        <h2 id="pseudo-heading" class="visually-hidden">Mon Pseudo</h2>
        <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom:10px;">
          <span id="pseudo-display"
                class="pseudo-cally"
                contenteditable="true"
                spellcheck="false"
                tabindex="0"
                aria-label="Votre pseudo"
                onfocus="this.style.boxShadow='0 0 8px #e0c18588';"
                onblur="this.style.boxShadow='none';"
                oninput="document.getElementById('pseudo-input').value=this.textContent.trim(); localStorage.setItem('pseudo', this.textContent.trim());">
            <!-- Le pseudo sera inject√© ici par JS -->
          </span>
          <span onclick="document.getElementById('pseudo-display').focus();"
                title="Modifier le pseudo"
                class="pseudo-crayon"
                tabindex="0"
                role="button"
                aria-label="Modifier le pseudo">üñãÔ∏è</span>
        </div>
        <!-- Champ cach√© pour compatibilit√© JS/localStorage -->
        <input id="pseudo-input" type="text" maxlength="20" aria-label="Saisir votre pseudo" style="display:none;" />
        <div id="pseudo-feedback" class="feedback-message visually-hidden" role="alert" aria-live="polite"></div>
      </section>

      <!-- Section Statistiques -->
      <section class="statistiques" aria-labelledby="stats-heading">
        <h2 id="stats-heading">Statistiques</h2>
        <p>Parties jou√©es : <strong id="stat-parties">0</strong></p>
        <p>Parties gagn√©es : <strong id="stat-victoires">0</strong></p>
        <p>‚Üí En tant qu'enqu√™teur : <strong id="stat-enqueteur">0</strong></p>
        <p>‚Üí En tant que criminel : <strong id="stat-criminel">0</strong></p>
        <p>Record de dur√©e d'une victoire : <strong id="stat-record">‚Äî</strong></p>
        <p>Note : <strong id="grade">‚Äî</strong></p>
      </section>

      <!-- Section Historique des parties -->
      <section class="historique-section" aria-labelledby="historique-heading">
        <h2 id="historique-heading">Historique des derni√®res parties</h2>
        <ul id="historique-liste">
          <li>Aucune partie jou√©e pour le moment.</li>
        </ul>
      </section>

      <!-- Badges -->
      <section class="badges-section" aria-labelledby="badges-heading">
        <h2 id="badges-heading">Mes Badges</h2>
        <ul role="list">
          <li><img src="/Public/images/badges/detective.png" alt="Badge D√©tective" /></li>
          <li><img src="/Public/images/badges/furtif.png" alt="Badge Furtif" /></li>
          <li><img src="/Public/images/badges/veteran.png" alt="Badge V√©t√©ran" /></li>
        </ul>
      </section>

      <button type="button" onclick="location.href='accueil.html'">Retour √† l'accueil</button>

      <!-- Avatar Modal -->
      <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title"
        aria-describedby="avatar-list" tabindex="-1">
        <div class="modal-content" role="document">
          <h3 id="modal-title">Choisissez votre avatar</h3>
          <div id="avatar-list" class="avatar-list" role="list" aria-label="Liste des avatars disponibles"></div>
          <div class="modal-buttons">
            <button type="button" id="btn-valider-avatar" disabled>Valider</button>
            <button type="button" onclick="fermerModal()">Retour</button>
          </div>
          <div id="avatar-feedback" class="feedback-message" aria-live="polite"></div>
        </div>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Pseudo en calligraphie dor√©e modifiable
      const pseudoDisplay = document.getElementById("pseudo-display");
      const pseudoInput = document.getElementById("pseudo-input");
      let pseudo = localStorage.getItem("pseudo") || "Anonyme";
      pseudoDisplay.textContent = pseudo;
      pseudoInput.value = pseudo;

      // "Entr√©e" termine l'√©dition
      pseudoDisplay.addEventListener("keydown", function(e) {
        if (e.key === "Enter") {
          e.preventDefault();
          pseudoDisplay.blur();
        }
      });

      // Sauvegarde sur blur
      pseudoDisplay.addEventListener("blur", function() {
        let newPseudo = pseudoDisplay.textContent.trim() || "Anonyme";
        localStorage.setItem("pseudo", newPseudo);
        pseudoDisplay.textContent = newPseudo;
        pseudoInput.value = newPseudo;
      });

      // Mobile: clavier auto au focus
      pseudoDisplay.addEventListener("touchstart", function() {
        pseudoDisplay.focus();
      });

      // Ancien code pour compatibilit√© (si besoin ailleurs)
      // document.getElementById("btn-save-pseudo").addEventListener("click", function(event) {
      //   let newPseudo = pseudoInput.value.trim();
      //   if (newPseudo === "") {
      //     newPseudo = "Anonyme";
      //     pseudoFeedback.textContent = "Aucun pseudo renseign√©, vous √™tes Anonyme.";
      //     pseudoFeedback.className = "feedback-message erreur";
      //     pseudoFeedback.classList.remove("visually-hidden");
      //   } else {
      //     pseudoFeedback.textContent = "Pseudo enregistr√©‚ÄØ!";
      //     pseudoFeedback.className = "feedback-message succes";
      //     pseudoFeedback.classList.remove("visually-hidden");
      //   }
      //   localStorage.setItem("pseudo", newPseudo);
      //   pseudoInput.value = newPseudo;
      // });
    });
  </script>
  
  <script src="../JS/script.js"></script>

  <noscript>
    <div style="color: #e0c185; text-align: center; margin-top: 20px;" role="alert">
      ‚ö†Ô∏è JavaScript est d√©sactiv√©. Vous ne pourrez pas modifier votre avatar ou pseudo.
    </div>
  </noscript>

  <footer class="footer">
    <p>¬© 2025 Murder Party. Tous droits r√©serv√©s.</p>
    <a href="mentions-legales.html">Mentions l√©gales</a>
  </footer>
</body>
</html>
